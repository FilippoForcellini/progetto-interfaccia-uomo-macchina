@model Pianificazioneturni.Web.Areas.Example.Users.NaveDetailViewModel
@{
    var nascondiCalendario = ViewBag.NascondiCalendario ?? false;
}

<div class="modal-title">@(Model.Id == 0 ? "Nuova Nave" : "Dettaglio Nave")</div>

<form id="formNave" method="post" asp-action="SalvaNave" onsubmit="return validaFormNave()">
    <input type="hidden" name="id" id="inputNaveId" value="@Model.Id" />

    @if (nascondiCalendario)
    {
        <!-- Data nascosta per Oggi/Domani -->
        <input type="hidden" name="dataArrivo" id="inputDataArrivo" value="@Model.DataArrivo.ToString("yyyy-MM-dd")" />
        <div class="form-group mb-3">
            <label class="form-label fw-bold">Data:</label>
            <div class="form-control-plaintext fw-bold text-primary">@Model.DataArrivo.ToString("dd/MM/yyyy")</div>
        </div>
    }
    else
    {
        <!-- Campo data visibile per giorni futuri -->
        <div class="form-group mb-3">
            <label class="form-label fw-bold">Data Arrivo:</label>
            <input type="date" class="form-control" name="dataArrivo" id="inputDataArrivo"
                   value="@Model.DataArrivo.ToString("yyyy-MM-dd")"
                   min="@DateTime.Today.AddDays(2).ToString("yyyy-MM-dd")"
                   onchange="aggiornaStatoFasce()" required />
        </div>
    }

    <div class="form-group mb-3">
        <label class="form-label fw-bold">Nome:</label>
        <input type="text" class="form-control" name="nome" id="inputNome" value="@Model.Nome" required />
    </div>

    <div class="form-group mb-3">
        <label class="form-label fw-bold">Tipo Nave:</label>
        <select class="form-select" name="tipo" id="selectTipo">
            @foreach (var tipo in Pianificazioneturni.Web.Areas.Example.Users.TipiNave.GetTipi())
            {
                if (Model.Tipo == tipo.Tipo)
                {
                    <option value="@((int)tipo.Tipo)" selected>@tipo.Nome</option>
                }
                else
                {
                    <option value="@((int)tipo.Tipo)">@tipo.Nome</option>
                }
            }
        </select>
    </div>

    <div class="form-group mb-3">
        <label class="form-label fw-bold">Fasce Orarie:</label>
        <small class="text-muted d-block mb-2">Seleziona una o più fasce orarie in cui la nave sarà presente</small>

        <!-- Avviso fasce tutte occupate -->
        <div id="avvisoFasceOccupate" class="alert alert-warning mb-2" style="display: none;">
            Tutte le fasce orarie sono occupate per questo giorno.
        </div>

        <div class="fascia-oraria-group">
            <!-- Fascia Mattina -->
            <div class="fascia-oraria-item @(Model.FasciaMattina ? "selected" : "")"
                 data-fascia="mattina" onclick="toggleFascia(this)">
                <input type="checkbox" name="fasciaMattina" id="checkFasciaMattina" value="true"
                       @(Model.FasciaMattina ? "checked" : "") />
                <div class="fascia-label">00:00 / 08:00</div>
                <div class="fascia-status">Disponibile</div>
            </div>

            <!-- Fascia Pomeriggio -->
            <div class="fascia-oraria-item @(Model.FasciaPomeriggio ? "selected" : "")"
                 data-fascia="pomeriggio" onclick="toggleFascia(this)">
                <input type="checkbox" name="fasciaPomeriggio" id="checkFasciaPomeriggio" value="true"
                       @(Model.FasciaPomeriggio ? "checked" : "") />
                <div class="fascia-label">08:00 / 16:00</div>
                <div class="fascia-status">Disponibile</div>
            </div>

            <!-- Fascia Sera -->
            <div class="fascia-oraria-item @(Model.FasciaSera ? "selected" : "")"
                 data-fascia="sera" onclick="toggleFascia(this)">
                <input type="checkbox" name="fasciaSera" id="checkFasciaSera" value="true"
                       @(Model.FasciaSera ? "checked" : "") />
                <div class="fascia-label">16:00 / 24:00</div>
                <div class="fascia-status">Disponibile</div>
            </div>
        </div>
    </div>

    <div class="form-group mb-3">
        <label class="form-label fw-bold">Pontile:</label>
        <input type="number" class="form-control" name="pontile" id="inputPontile" value="@Model.Pontile" min="1" required />
    </div>

    <div class="form-group mb-3">
        <label class="form-label fw-bold">Ruoli Richiesti:</label>
        <div class="form-check">
            <input type="checkbox" class="form-check-input" name="richiedeGruisti" id="checkGruisti" value="true" @(Model.RichiedeGruisti ? "checked" : "") />
            <label class="form-check-label" for="checkGruisti">Gruisti</label>
        </div>
        <div class="form-check">
            <input type="checkbox" class="form-check-input" name="richiedeMulettisti" id="checkMulettisti" value="true" @(Model.RichiedeMulettisti ? "checked" : "") />
            <label class="form-check-label" for="checkMulettisti">Mulettisti</label>
        </div>
    </div>

    <div class="modal-footer d-flex justify-content-center gap-2 mt-4">
        @if (Model.Id != 0)
        {
            <button type="button" class="btn btn-danger" onclick="eliminaNave(@Model.Id)">Elimina</button>
        }
        <button type="submit" class="btn btn-success">Salva</button>
    </div>
</form>
